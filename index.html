<!DOCTYPE html>

<html>
	<head>
		<script src="js/wad.min.js"></script>
		<title>Guitar Tab Player</title>
		<style>
			textarea{
				width:80vw;
				height:60vh;
			}
			body{
				text-align: center;
			}
		</style>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
		<link rel="stylesheet" href="css/bootflat.min.css">
	</head>
	<body>
		<h2>Guitar Tab Player</h2>
		<h5>By <a href="http://github.com/mjkaufer">Matthew Kaufer</a></h5>
		<p>Warning: Because of the way most browsers manage resources, <b>switching tabs will slow the current playback by <u>a lot</u>!</b></p>
		<textarea id="tab">
e|-0-0-0---0-3-----| |----------------------0-3-5--1-3-0--------|
B|-------1---------| |-1----------0---------1-5-6--3-5-1--1-3-0-|
G|-----------0---0-| |-0--0-----2-0-3-2---0---------------2-4-0-|
D|-0-0-0-0---------| |----2--2--3---4-3---2---------------------|
A|-----------------| |-------3----------------------------------|
E|---------------3-| |------------------------------------------|

|----------------------0-3-5--1-3-0--------|
|-1----------0---------1-5-6--3-5-1--1-3-0-|
|-0--0-----2-0-3-2---0---------------2-4-0-|
|----2--2--3---4-3---2---------------------|
|-------3----------------------------------|
|------------------------------------------|

e|---3-2-1-----0-------------------3-2-1-----0--8-8-8------3-2-1-----0-------------------------------|
B|---------4-----------1-----1-3---------4------8-8-8------------4-----------1-----1-3--4-3-1--------|
G|-----0-----5-----1-2-----2---------0-----5-----------------0-----5-----1-2-----2------5-3-0--------|
D|----------------------------------------------------5-------------------------------------2--5-5---|
A|-3---------------------3-------3-----------------------3---------------------3----------1-3------3-|
E|---------------1-----------1-----------------------------------------1-----------1----4------------|

e|---3-2-1-----0-------------------3-2-1-----0--8-8-8------3-2-1-----0-------------------------------|
B|---------4-----------1-----1-3---------4------8-8-8------------4-----------1-----1-3--4-3-1--------|
G|-----0-----5-----1-2-----2---------0-----5-----------------0-----5-----1-2-----2------5-3-0--------|
D|----------------------------------------------------5-------------------------------------2--5-5---|
A|-3---------------------3-------3-----------------------3---------------------3----------1-3------3-|
E|---------------1-----------1-----------------------------------------1-----------1----4------------|

e|------------------------------------------------------------|
B|-1-1--1-1-3-5-1-------1-1--1-1-3-5-------1-1--1-1-3-5-1-----|
G|-1----1---3-----2-0---1----1---3---------1----1---3-----2-0-|
D|------1-----5-2-2----------1-----5------------1-----5-2-2---|
A|------------3--------------------3---3--------------3-------|
E|-4----------------3-3-4----------------3-4----------------3-|

e|-0-0-0---0-3-----| |----------------------0-3-5--1-3-0--------|
B|-------1---------| |-1----------0---------1-5-6--3-5-1--1-3-0-|
G|-----------0---0-| |-0--0-----2-0-3-2---0---------------2-4-0-|
D|-0-0-0-0---------| |----2--2--3---4-3---2---------------------|
A|-----------------| |-------3----------------------------------|
E|---------------3-| |------------------------------------------|

|----------------------0-3-5--1-3-0--------|
|-1----------0---------1-5-6--3-5-1--1-3-0-|
|-0--0-----2-0-3-2---0---------------2-4-0-|
|----2--2--3---4-3---2---------------------|
|-------3----------------------------------|
|------------------------------------------|

e|-0-----------1-1-------5-5-5-3-1-0----------0------------1-1-------1-1-1-0------------|
B|---1-----------1-----0---6---5-3---1----------1------------1-----0-0-0-0-1-3-1--------|
G|-----0---1-2-----2---0---0---0--------2-0-------0---1--2-----2---0---------0-0--------|
D|-----------3---3-3-------------3-----------------------3---3-3---------------2-2--2---|
A|-3-------3-----------------------3----------3-------3--------------------0-2-3------3-|
E|-------3---1-----1---3----------------2-3---------3----1-----1---3---3-3--------------|

e|-0-----------1-1-------5-5-5-3-1-0----------0------------1-1-------1-1-1-0------------|
B|---1-----------1-----0---6---5-3---1----------1------------1-----0-0-0-0-1-3-1--------|
G|-----0---1-2-----2---0---0---0--------2-0-------0---1--2-----2---0---------0-0--------|
D|-----------3---3-3-------------3-----------------------3---3-3---------------2-2--2---|
A|-3-------3-----------------------3----------3-------3--------------------0-2-3------3-|
E|-------3---1-----1---3----------------2-3---------3----1-----1---3---3-3--------------|

e|------------------------------------------------------------| |-0-0-0---0-3-----|
B|-1-1--1-1-3-5-1-------1-1--1-1-3-5-------1-1--1-1-3-5-1-----| |-------1---------|
G|-1----1---3-----2-0---1----1---3---------1----1---3-----2-0-| |-----------0---0-|
D|------1-----5-2-2----------1-----5------------1-----5-2-2---| |-0-0-0-0---------|
A|------------3--------------------3---3--------------3-------| |-----------------|
E|-4----------------3-3-4----------------3-4----------------3-| |---------------3-|

e|-----------------------------------------|
B|-1------------0--------------------------|
G|-0--0-----2------2-------3---------------|
D|----2--2--3----------6-----6---5---3---5-|
A|-------3-------------4---------3---------|
E|----------1------------------------------|

e|-----------0-3---0---------------4-------------------6---6-6-6-8-|
B|---------1-------------------1-4-----4-----------3-6-------------|
G|-------0-------------------1-------------------3---------7-7-7-9-|
D|-----2-------------------1-------------------3-------------------|
A|---3-------------------3-------------------5---------------------|
E|-3-------------------4-------------------6---------------------8-|
		</textarea>
		<br>
		<label><b>Milliseconds per Note</b></label>
		<br>
		<input id="speed" type="number" value="75">
		<br>
		<br>
		<button class="btn btn-primary" id="play"><span class="glyphicon glyphicon-play"></span>&nbsp;Play Your Tab!</button>
		<br>
		<br>
		<button class="btn btn-danger" id="stop"><span class="glyphicon glyphicon-stop"></span>&nbsp;Stop</button>
		<br>
		<br>
		<br>
		<script>

			var guitars = []


			var frequencies = [
				/*e*/[330, 349, 370, 392, 415, 440, 466, 494, 523, 554, 587, 622, 659, 698, 740, 784, 831, 880, 932, 988, 1047],
				/*b*/[247, 262, 277, 294, 311, 330, 349, 370, 392, 415, 440, 466, 494, 523, 554, 587, 622, 659, 698, 740, 784],
				/*g*/[196, 208, 220, 233, 247, 262, 277, 294, 311, 330, 349, 370, 392, 415, 440, 466, 494, 523, 554, 587, 622],
				/*d*/[147, 156, 165, 175, 185, 196, 208, 220, 233, 247, 262, 277, 294, 311, 330, 349, 370, 392, 415, 440, 466],
				/*a*/[110, 117, 123, 131, 139, 147, 156, 165, 175, 185, 196, 208, 220, 233, 247, 262, 277, 294, 311, 330, 349],
				/*E*/[82, 87, 92, 98, 104, 110, 117, 123, 131, 139, 147, 156, 165, 175, 185, 196, 208, 220, 233, 247, 262]
			]

			function makeGuitar(){
				var guitar = new Wad(Wad.presets.piano)
				guitar.source = "sawtooth"
				return guitar
			}

			function playNotes(arr){//arr is a 6 slot array, with either a number (0-20, inclusive), or null
				for(var i = 0; i < arr.length; i++){
					if(isNaN(arr[i]))
						continue;

					var string = guitars[i];
					string.play({pitch: frequencies[i][arr[i]]})
				}
			}

			function mute(){// currently a bit buggy
				for(var i = 0; i < guitars.length; i++){
					// console.log(i)
					try{
						guitars[i].stop()	
					} catch(e){}
				}
			}

			for(var i = 0; i < frequencies.length; i++)
				guitars[i] = makeGuitar()

			// var song = [
			// 	"E-------5-7-----7-|-8-----8-2-----2-|-0---------0-----|--------------------|",
			// 	"B-----5-----5-----|---5-------3-----|---1---1-----1---|-0-1-1--------------|",
			// 	"G---5---------5---|-----5-------2---|-----2---------2-|-0-2-2--------------|",
			// 	"D-7-------6-------|-5-------4-------|-3---------------|--------------------|",
			// 	"A-----------------|-----------------|-----------------|-2-0-0---0--/8-7----|",
			// 	"E-----------------|-----------------|-----------------|--------------------|"
			// ]

			// song = addToSong(song, [
			// 	"E||--1-----0--1---3-1--|--0--------0---1-0--|--------------------|",
			// 	"B||--3---3-------------|--1---1-3-----------|--3--------3---5-3--|",
			// 	"G||--2-----------------|--0-----------------|--3---3-5--3--------|",
			// 	"D||--0-----------------|--2-----------------|--3--------0--------|",
			// 	"A||--------------------|--3-----------------|--1-----------------|",
			// 	"E||--------------------|--------------------|-----------3--------|",
			// ])

			var song = [
				"E||--1-----0--1---3-1--|--0--------0---1-0--|--------------------|",
				"B||--3---3-------------|--1---1-3-----------|--3--------3---5-3--|",
				"G||--2-----------------|--0-----------------|--3---3-5--3--------|",
				"D||--0-----------------|--2-----------------|--3--------0--------|",
				"A||--------------------|--3-----------------|--1-----------------|",
				"E||--------------------|--------------------|-----------3--------|",
			]


			song = addToSong(song, [
				"-------------------|--1------0-1---3-1--|--0--------0---1-0--|",
				"--2---3----2-------|--3----3------------|--1----1-3----------|",
				"--2-----4-------2--|--2-----------------|--0-----------------|",
				"--2----------------|--0-----------------|--2-----------------|",
				"--0----------------|--------------------|--3-----------------|",
				"-------------------|--------------------|--------------------|",
			])

			song = addToSong(song, [
				"--------------------|-------0---------|--5----1-3-5---6-5--|",
				"--3---5-3--3---5-3--|--2-------3------|--1-----------------|",
				"--3--------3--------|--2-------2------|--2-----------------|",
				"--3--------0--------|--2-------0------|--------------------|",
				"--1-----------------|--0--------------|--------------------|",
				"-----------3--------|-----------------|--1-----------------|",
			])

			song = addToSong(song, [
				"--3--------3---5-3-1-|--1------0-1----3-1-|--0--------------0-------|",
				"--5----5-6-----------|--3----3---3--------|--2h-3p-2---(2)-------2--|",
				"--5------------------|--2--------3--------|--2----------------------|",
				"---------------------|--0-----------------|-------------------------|",
				"--3------------------|-----------1--------|--0----------------------|",
				"---------------------|--------------------|-------------------------|",
			])

			song = addToSong(song, [
				"--5----1-3-5--6-5-3-1-|--3----0-1-3--5-3-1-0-|--1----0-1--1--3-1-0---|",
				"--1-------------------|--5-------------------|--3--3------3--------3-|",
				"--2-------------------|--5-------------------|--2---------3----------|",
				"--3-------------------|----------------------|--0--------------------|",
				"----------------------|--3-------------------|------------1----------|",
				"----------------------|----------------------|-----------------------|",
			])

			song = addToSong(song, [
				"--0-------0---(1)------|----------1-L---------1---|----------0-L---------0-----|",
				"--1--1---(1)---3-------|----3---3-------3---3-----|----1---1-------1---1----1--|",
				"--2----2-------2-------|--2---2-------2---2-0---2-|--0---0-------0---0-----(0)-|",
				"--2------------0-------|--3-------2---3-------3---|----------0---2-----3-2-----|",
				"--0--------------------|--------------------------|--------3-------------------|",
				"-----------------------|--------------------------|----------------------------|",
			])

			song = addToSong(song, [
				"--------------------------|---------------------------|",
				"----------3-L---------3---|-----------3-L---------2---|",
				"----3---3-------3---3---3-|----3----3-------2---2---2-|",
				"--3---3-------3---3-2-0---|--0---0h-2-0---2---2-------|",
				"--------1-3---5-----------|---------------4-------0-L-|",
				"--------------------------|---------------------------|",
			])

			song = addToSong(song, [
				"----------1-L---------5---|----------0-L---------3-----|",
				"----3---3-------3---3-----|----1---1-------1---1----1--|",
				"--2---2-------2---2-0---2-|--0---0-------0---0-----(0)-|",
				"--3-------2---3-------3---|------------0-2-----3-2-----|",
				"--------------------------|----------3-----------------|",
				"--------------------------|----------------------------|",
			])

			song = addToSong(song, [
				"---------------------------|---------------1------|--5------1-(3)-5-----6-5--|",
				"----------3-L----------3-L-|---------------3------|-------------------1------|",
				"----3---3-------3---3------|----2---2--2---2------|-------0-2-----2-3---2----|",
				"--3---3-------3---3--------|--2---2--------0------|--3--3------3----------3--|",
				"--------------5-----7p-5---|--5-------(4)---------|--------------------------|",
				"---------------------------|----------------------|--------------------------|",
			])

			song = addToSong(song, [
				"--3--------1-3---5-3-1--0--|--1--------0-1-----3-1--|",
				"-------3-5-1-----1---------|---------3--------------|",
				"--5--5---------0---0-------|---------------0-2------|",
				"-------------2---------(2)-|--0--0-2-3-0-3-----3-0--|",
				"---------------------4--L--|------------------------|",
				"---------------------------|------------------------|",
			])

			song = addToSong(song, [
				"--0h-1p-0-------------------0-3---|--5------1-(3)-5---6-5-3-1-|",
				"----------------3----1------------|---------------------------|",
				"------------------0-----0---------|-------0-2-----2-3-5-2-----|",
				"----------0-2---2---------2---0-2-|--3--3------3----------3---|",
				"--3-----------3-----(3)-----3-----|---------------------------|",
				"----------------------------------|---------------------------|",
			])

			song = addToSong(song, [
				"--3------0-1-3---5-3-1-0-|--1----0-1--------0-1-3-|---0--------(1)------|",
				"-------------------------|-----3----------3-------|--(1)-------(3)------|",
				"---------0-------0-----2-|------------------------|------------(2)------|",
				"--2--2-3---2---2---2-----|--0--0-2-3-0--------0---|-------------0-------|",
				"-------------3-------3-L-|-------------1--1-3---1-|---0-----0-----------|",
				"-------------------------|------------------------|---------------------|",
			])

			song = addToSong(song, [
				"---------0--1--0h-1p-0----|--0--0-1-3--1-3p-1p---0---|",
				"-----2-3----3----------3--|------------3-----------3-|",
				"--2---------2-------------|--2---------2-------------|",
				"--2---------0-------------|--2---------0-------------|",
				"--0-----------------------|--0-----------------------|",
				"--------------------------|--------------------------|",
			])

			song = addToSong(song, [
				"-------0-1-0-0-----0-1-0---|----------0---------|",
				"-----3----------3--------3-|-----3--3---3----2--|",
				"--3----------0-------------|--0---------2-------|",
				"--3----------0-------------|--0---------2-------|",
				"--1------------------------|------------0-------|",
				"-------------3-------------|--3-----------------|",
			])

			song = addToSong(song, [
				"------------0---0-1p-0-----------------|------0--------0h-1p--0---------|",
				"------2--3------3----------(5)p-3------|--3--------3---3---------3--3---|",
				"--2--(2)---(2)--2------(2)--------(2)--|--2--(2)--(2)--2-----(2)---(2)--|",
				"--2-------------0----------------------|--2------------0----------------|",
				"--0------------------------------------|--0-----------------------------|",
				"---------------------------------------|--------------------------------|",
			])

			song = addToSong(song, [
				"------------------------------|----------------3-0h-1p-0-----------|",
				"------3--5--6--5h-6p-5-----3--|------3h-5h--6----------------------|",
				"--3--(3)---(3)-------3--3--3--|--0--(0)----(0)---2-------(2)--(2)--|",
				"--3------------------3--------|--0---------------2-----------------|",
				"--1------------------1--------|------------------0-----------------|",
				"------------------------------|--3---------------------------------|",
			])

			song = addToSong(song, [
				"--3-------3--L-5p-3---3---|--1h-3p-1-0---1--0------|",
				"--3--5h-6-----------6---6-|------------------------|",
				"--3-----------------------|--2---------------------|",
				"--2-----------------------|--2---------------------|",
				"--------------------------|--0---------------------|",
				"--------------------------|------------------------|",
			])

			song = addToSong(song, [
				"--3-------3--L-5p-3----------------|--9---------------|--1-----0--1---3-1--|",
				"--3--5h-6-----------6-6p-5-6h-8p-6-|------------------|--3---3-------------|",
				"--3--------------------------------|--9--------(9)----|--2-----------------|",
				"--2--------------------------------|--7---------------|--0-----------------|",
				"-----------------------------------|--0---------------|--------------------|",
				"-----------------------------------|------------------|--------------------|",
			])

			song = addToSong(song, [
				"--0--------0---1-0--|--------------------|-------------------|",
				"--1---1-3-----------|--3--------3---5-3--|--2---3----2-------|",
				"--0-----------------|--3---3-5--3--------|--2-----4-------2--|",
				"--2-----------------|--3--------0--------|--2----------------|",
				"--3-----------------|--1-----------------|--0----------------|",
				"--------------------|-----------3--------|-------------------|",
			])

			song = addToSong(song, [
				"--1------0-1---3-1--|--0--------0---1-0--|--------------------|",
				"--3----3------------|--1----1-3----------|--3---5-3--3---5-3--|",
				"--2-----------------|--0-----------------|--3--------3--------|",
				"--0-----------------|--2-----------------|--3--------0--------|",
				"--------------------|--3-----------------|--1-----------------|",
				"--------------------|--------------------|-----------3--------|",
			])

			song = addToSong(song, [
				"-------0---------|--5----1-3-5---6-5--|--3--------3---5-3-1-|",
				"--2-------3------|--1-----------------|--5----5-6-----------|",
				"--2-------2------|--2-----------------|--5------------------|",
				"--2-------0------|--------------------|---------------------|",
				"--0--------------|--------------------|--3------------------|",
				"-----------------|--1-----------------|---------------------|",
			])

			song = addToSong(song, [
				"--1------0-1----3-1-|--0--------------0-------|--5----1-3-5--6-5-3-1-|",
				"--3----3---3--------|--2h-3p-2---(2)-------2--|--1-------------------|",
				"--2--------3--------|--2----------------------|--2-------------------|",
				"--0-----------------|-------------------------|--3-------------------|",
				"-----------1--------|--0----------------------|----------------------|",
				"--------------------|-------------------------|----------------------|",
			])

			song = addToSong(song, [
				"--3----0-1-3--5-3-1-0-|--1----0-1--1--3-1-0---|--0-------0---(1)------|",
				"--5-------------------|--3--3------3--------3-|--1--1---(1)---3-------|",
				"--5-------------------|--2---------3----------|--2----2-------2-------|",
				"----------------------|--0--------------------|--2------------0-------|",
				"--3-------------------|------------1----------|--0--------------------|",
				"----------------------|-----------------------|-----------------------|",
			])

			song = addToSong(song, [
				"-------(1)--------|----13------------||",
				"--3-----3---------|----10------------||",
				"--------2---------|----10------------||",
				"--------0---------|--<>12------------||",
				"------------------|------------------||",
				"------------------|------------------||",
			])

			var chordRegex = /[EBGDA]/gi;
			var breakRegex = /\-\|\-/g;

			function cleanTab(tab){
				for(var i = 0; i < tab.length; i++){
					tab[i] = tab[i].replace(chordRegex,"");
					tab[i] = tab[i].replace(breakRegex,"-");
					tab[i] = tab[i].replace(/\|/g, "");
				}

				return tab;
			}

			function addToSong(song, arr){
				for(var i = 0; i < song.length; i++)
					song[i] += arr[i]
				return song
			}

			function songToNotes(song, index){
				var ret = [];

				for(var i = 0; i < song.length; i++)
					ret.push(song[i].substr(index, 1))

				return ret
			}

			song = cleanTab(song);


			var index = 0;
			var musicInterval = 0;

			function playSong(song){
				index = 0;
				clearInterval(musicInterval)

				musicInterval = setInterval(function(){
					if(index >= song[0].length)
						// index %= song[0].length;//the show must go on!
						return clearInterval(musicInterval)

					var notes = songToNotes(song, index);
					// mute();
					playNotes(notes);

					index++;

				}, document.getElementById('speed').value)
			}

			var play = document.getElementById('play');

			play.onclick = function(){
				var text = document.getElementById('tab').value;
				text = text.replace(/\n+/g, "\n").split("\n");

				var newSong = ["", "", "", "", "", ""]

				for(var i = 0; i < text.length; i++)
					newSong[i % newSong.length] += text[i]

				clearInterval(musicInterval)

				playSong(newSong)
			}

			var stop = document.getElementById('stop');

			stop.onclick = function(){
				clearInterval(musicInterval)
			}

		</script>
	</body>
</html>